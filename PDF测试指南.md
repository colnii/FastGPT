# 同仁堂PDF表格处理测试指南

## 测试步骤

### 1. 启动FastGPT服务

```bash
cd fastgpt-pro
# 启动所有服务
docker-compose up -d
# 或者如果使用开发模式
pnpm dev
```

### 2. 配置PDF增强解析

确保你的`config.json`中启用了PDF增强解析：

```json
{
  "systemEnv": {
    "customPdfParse": {
      "url": "http://localhost:7231/v2/parse/file",
      "key": "",
      "price": 0
    }
  }
}
```

### 3. 导入同仁堂PDF测试

#### 3.1 创建新知识库
1. 登录FastGPT管理界面
2. 进入"知识库"页面
3. 点击"创建知识库"
4. 命名为"同仁堂研报测试"

#### 3.2 上传PDF文件
1. 进入新创建的知识库
2. 点击"导入数据"
3. 选择"本地文件"
4. **重要：勾选"PDF增强解析"选项**
5. 上传`同仁堂研报.pdf`文件
6. 设置分块参数：
   - 分块大小：512-1000（建议800）
   - 分块重叠：10-15%

#### 3.3 观察处理结果
等待PDF处理完成后，检查以下内容：

**A. 数据预览**
- 进入知识库的"数据"页面
- 查看分块结果
- 检查表格是否被正确识别为Markdown格式

**B. 表格完整性检查**
寻找包含以下内容的分块：
```
| 项目 | 单位 | 2019年 | 2020年 | 2021年 | 2022E | 2023E | 2024E |
| --- | --- | --- | --- | --- | --- | --- | --- |
| 3. 妇科类(马鞍白风丸、埋宝丸) | | 3.80 | 3.48 | 3.77 | 3.96 | 4.15 | 4.36 |
| 同比 | % | 23.83% | -8.38% | 8.28% | 5.00% | 5.00% | 5.00% |
| 毛利率 | % | 40.16% | 38.12% | 42.38% | 42.00% | 42.00% | 42.00% |
```

### 4. 验证搜索效果

#### 4.1 创建测试应用
1. 在"应用"页面创建新应用
2. 添加"知识库搜索"模块
3. 连接到"同仁堂研报测试"知识库

#### 4.2 测试查询
尝试以下查询来验证表格数据的检索效果：

**财务数据查询：**
- "同仁堂妇科类产品的毛利率是多少？"
- "清热类产品2021年的收入情况"
- "各产品线的同比增长率对比"

**表格结构查询：**
- "显示同仁堂各业务分部的收入数据"
- "2022年到2024年的盈利预测数据"

### 5. 对比测试（验证改进效果）

#### 5.1 禁用增强解析测试
1. 创建另一个知识库"同仁堂研报对比"
2. **不勾选"PDF增强解析"**
3. 上传相同的PDF文件
4. 对比两个知识库的分块结果

#### 5.2 对比检查点
- **表格识别率**：增强版本应该有更多完整的表格
- **数据完整性**：跨页表格应该被正确合并
- **搜索准确性**：相同查询在增强版本中应该返回更准确的结果

## 预期改进效果

### 优化前（未启用增强解析）
- 表格被分割成多个文本片段
- 数据关系丢失，如"同比 % 23.83%"与产品名称分离
- 搜索"毛利率"可能无法准确匹配到相关数据

### 优化后（启用增强解析）
- 表格以完整Markdown格式存储
- 保持数据行与列的对应关系
- 支持复杂的表格数据查询和分析

## 快速测试脚本

如果你想快速验证算法，可以运行测试脚本：

```bash
cd fastgpt-pro/FastGPT
node test/table-processing-test.js
```

这个脚本会使用同仁堂PDF中的实际表格数据来测试我们的处理算法。

## 故障排除

### 1. PDF解析失败
- 检查PDF解析服务是否正常运行
- 确认配置文件中的URL正确
- 查看服务日志：`docker logs fastgpt`

### 2. 表格仍然被分割
- 检查分块大小设置是否足够大
- 验证表格处理配置是否生效
- 查看具体的分块内容，确认问题类型

### 3. 搜索效果不佳
- 检查向量化是否完成
- 尝试不同的搜索关键词
- 调整相似度阈值设置

## 测试报告模板

测试完成后，可以按以下格式记录结果：

```
测试时间：[日期]
PDF文件：同仁堂研报.pdf
文件大小：[大小]
总页数：[页数]

处理结果：
- 是否启用增强解析：是/否
- 处理时间：[秒]
- 总分块数：[数量]
- 包含表格的分块：[数量]
- 完整表格分块：[数量]

问题发现：
[记录发现的问题]

改进建议：
[记录改进建议]
``` 